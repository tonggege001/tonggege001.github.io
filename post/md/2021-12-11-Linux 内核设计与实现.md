---
layout: post  
title: 2021-12-11-Linux内核设计与实现
date: 2021-12-11
categories: blog
tags: [Linux,操作系统,笔记]
description: 2021-12-11-Linux内核设计与实现
---  

# 1. Linux内核简介  
**内核**：内核由负责响应中断的**中断服务程序**、负责管理多个进程从而分享处理器事件的**调度程序**、负责管理进程地址空间的**内存管理程序**、网络、进程间通信等**系统服务程序**共同组成。  

**内核空间**：对于保护机制的现代系统来说，内核独立于普通应用程序，它一般处于系统态，拥有受保护空间和访问硬件设备的所有权限。  


**中断**：中断通常对应一个中断向量号，内核通过这个中断号查找相应的中断服务程序，并调用这个程序响应和处理中断。**许多操作系统的中断服务程序(包括Linux)，都不在进程上下文中执行，它们在一个与所有进程无关的、专门的中断上下文中运行**。  

**内核运行环境**：  
* 运行于用户空间，执行用户进程。
* 运行于内核空间，处于进程上下文，代表某个特定的进程执行。
* 运行于内核空间，处于中断上下文，与任何进程无关，处理某个特定的中断。

# 2. 从内核出发  
http://www.kernel.org 有最新的源代码，也可以用git获取：  
```shell  
git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux-2.6.git  
```  

**安装源代码**：内核源码一般安装在/usr/src/linux/目录下，但是不要把这个源码树用于开发，因为编译C库所用的内核版本就链接到这棵树。应当建立自己的主目录，仅以root身份去安装新内核，即使在安装新内核时，/usr/src/linux目录都应当原封不动。  

**应用增量补丁**：  
```shell  
patch -p1 < ../patch.x.y.z
```  

**内核中的文件**  
|目录|描述|
|:----:|:----:|
|arch|特定体系结构的源码|
|block|块设备IO层|
|crypto|加密API|
|Documentation|文档|
|drivers|设备驱动程序|
|firmware|使用某些驱动程序而需要的设备**固件**|
|fs|VFS和各种文件系统|
|include|内核头文件|
|init|内核引导和初始化|
|ipc|进程间通信|
|kernel|像调度程序这样的**核心子系统**|
|lib|通用内核函数|
|mm|内存管理子系统和VM|
|net|网络子系统|
|samples|示例、示范代码|
|scripts|编译内核所使用的脚本|
|security|Linux安全模块|
|sound|语音子系统|
|usr|早期用户空间代码|
|tools|在Linux开发中有用的工具|
|virt|虚拟化基础结构|

COPYING是内核许可证，Makefile是基本内核的make文件。  

## 2.3 编译内核
